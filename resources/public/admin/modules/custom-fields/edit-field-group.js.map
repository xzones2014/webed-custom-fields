{"version":3,"names":[],"mappings":"","sources":["edit-field-group.js"],"sourcesContent":["!function(e){\"use strict\";var t=function(){this.$body=$(\"body\"),this.RULES_GROUP_TEMPLATE_HTML=$(\"#rules_group_template\").html();var e=this;this.$body.on(\"submit\",\".form-update-field-group\",function(t){var l=JSON.stringify(e.exportRulesToJson()),a=JSON.stringify(e.exportFieldsToJson());$(\"#custom_fields_rules\").html(l).val(l),$(\"#custom_fields\").html(a).val(a)}),this.handleRules(),this.handleFieldGroups()};t.prototype.handleRules=function(){var e=this,t=$.parseJSON($(\"#custom_fields_rules\").val());console.log(t);var l=$(e.RULES_GROUP_TEMPLATE_HTML),a=$(\"#rules_line_group_template\").html(),i=$(\".line-group-container\");e.$body.on(\"click\",\".location-add-rule\",function(e){e.preventDefault();var t=$(this),n=l.clone();if(t.hasClass(\"location-add-rule-and\"))t.closest(\".line-group\").append(n);else{var o=$(a);o.append(n),i.append(o)}n.find(\".rule-a\").trigger(\"change\")}),e.$body.on(\"change\",\".rule-a\",function(e){e.preventDefault();var t=$(this),l=t.closest(\".rule-line\");l.find(\".rules-b-group select\").addClass(\"hidden\"),l.find('.rules-b-group select[data-rel=\"'+t.val()+'\"]').removeClass(\"hidden\")}),e.$body.on(\"click\",\".remove-rule-line\",function(e){e.preventDefault();var t=$(this),l=t.closest(\".rule-line\"),a=t.closest(\".line-group\");a.find(\".rule-line\").length<2?a.remove():l.remove()}),t.length<1?$(\".location-add-rule\").trigger(\"click\"):t.forEach(function(e,t){var n=$(a);e.forEach(function(e,t){var a=l.clone();a.find(\".rule-a\").val(e.name),a.find(\".rule-type\").val(e.type),a.find('.rule-b:not([data-rel=\"'+e.name+'\"])').addClass(\"hidden\"),a.find('.rule-b[data-rel=\"'+e.name+'\"]').val(e.value),n.append(a)}),i.append(n)})},t.prototype.handleFieldGroups=function(){var e=this,t=0,l=$.parseJSON($(\"#custom_fields\").val()),a=[],i=$(\"#_new-field-source_template\").html(),n={repeater:$(\"#_options-repeater_template\").html(),defaultValue:$(\"#_options-defaultvalue_template\").html(),defaultValueTextarea:$(\"#_options-defaultvaluetextarea_template\").html(),placeholderText:$(\"#_options-placeholdertext_template\").html(),wysiwygToolbar:$(\"#_options-wysiwygtoolbar_template\").html(),selectChoices:$(\"#_options-selectchoices_template\").html(),buttonLabel:$(\"#_options-buttonlabel_template\").html(),rows:$(\"#_options-rows_template\").html()},o=function(e){var t=\"\";switch(e){case\"text\":case\"email\":case\"password\":case\"number\":t+=n.defaultValue+n.placeholderText;break;case\"image\":case\"file\":return\"\";case\"textarea\":t+=n.defaultValueTextarea+n.placeholderText+n.rows;break;case\"wysiwyg\":t+=n.defaultValueTextarea+n.wysiwygToolbar;break;case\"select\":t+=n.selectChoices+n.defaultValue;break;case\"checkbox\":t+=n.selectChoices;break;case\"radio\":t+=n.selectChoices;break;case\"repeater\":t+=n.repeater+n.buttonLabel}return t},s=function(e){e.each(function(e,t){var l=$(this),a=e+1;l.attr(\"data-position\",a)})},r=function(e,t){e.attr(\"data-position\",t||e.index()+1)},d=function(e){return i.replace(/___options___/gi,o(e||\"text\"))};e.$body.on(\"click\",\".show-item-details\",function(e){e.preventDefault();var t=$(this).closest(\"li\");$(this).toggleClass(\"active\"),t.toggleClass(\"active\")}),e.$body.on(\"click\",\".btn-close-field\",function(e){e.preventDefault();var t=$(this).closest(\"li\");t.toggleClass(\"active\"),t.find(\"> .field-column .show-item-details\").toggleClass(\"active\")}),e.$body.on(\"click\",\".btn-add-field\",function(e){e.preventDefault();var l=$(this);t++;var a=l.closest(\".add-new-field\").find(\"> .sortable-wrapper\"),i=$(d());a.append(i),i.find(\".line[data-option=title] input[type=text]\").focus(),r(i),i.find(\".sortable-wrapper\").sortable()}),e.$body.on(\"change\",\".change-field-type\",function(e){e.preventDefault();var t=$(this),l=t.closest(\".item-details\"),a=l.find(\"> .options\");a.html(o(t.val()))}),e.$body.on(\"change blur\",\".line[data-option=slug] input[type=text]\",function(e){var t=$(this),l=WebEd.stringToSlug(t.val(),\"_\"),a=t.closest(\".line\");a.closest(\".ui-sortable-handle\").find(\"> .field-column .field-slug\").text(l),t.val(l)}),e.$body.on(\"change blur\",\".line[data-option=type] select\",function(e){var t=$(this),l=WebEd.stringToSlug(t.val(),\"_\"),a=t.closest(\".line\");a.closest(\".ui-sortable-handle\").find(\"> .field-column .field-type\").text(t.find('option[value=\"'+l+'\"]').text()),t.val(l)}),e.$body.on(\"change blur\",\".line[data-option=title] input[type=text]\",function(e){var t=$(this),l=t.closest(\".line\"),a=l.find(\"~ .line[data-option=slug] input[type=text]\"),i=t.val();l.closest(\".ui-sortable-handle\").find(\"> .field-column .field-label\").text(i),a.val()||a.val(WebEd.stringToSlug(i,\"_\")).trigger(\"change\")}),$(\"#deleted_items\").val(\"\"),e.$body.on(\"click\",\".btn-remove\",function(e){e.preventDefault();var t=$(this).closest(\".ui-sortable-handle\"),l=t.parent();a.push(t.data(\"id\")),t.animate({top:-60,left:60,opacity:.3},300,function(){t.remove(),s(l.find(\"> li\"))}),$(\"#deleted_items\").val(JSON.stringify(a))});var u=function(e,t){t.sortable(),e.forEach(function(e,l){var a=$(d(e.type||\"text\"));a.data(\"id\",e.id||0),a.find(\".line[data-option=type] select\").val(Helpers.arrayGet(e,\"type\",\"text\")),a.find(\".line[data-option=title] input\").val(Helpers.arrayGet(e,\"title\",\"\")),a.find(\".line[data-option=slug] input\").val(Helpers.arrayGet(e,\"slug\",\"\")),a.find(\".line[data-option=instructions] textarea\").val(Helpers.arrayGet(e,\"instructions\",\"\")),a.find(\".line[data-option=defaultvalue] input\").val(Helpers.arrayGet(e.options,\"defaultValue\",\"\")),a.find(\".line[data-option=defaultvaluetextarea] textarea\").val(Helpers.arrayGet(e.options,\"defaultValueTextarea\",\"\")),a.find(\".line[data-option=placeholdertext] input\").val(Helpers.arrayGet(e.options,\"placeholderText\",\"\")),a.find(\".line[data-option=wysiwygtoolbar] select\").val(Helpers.arrayGet(e.options,\"wysiwygToolbar\",\"basic\")),a.find(\".line[data-option=selectchoices] textarea\").val(Helpers.arrayGet(e.options,\"selectChoices\",\"\")),a.find(\".line[data-option=buttonlabel] input\").val(Helpers.arrayGet(e.options,\"buttonLabel\",\"\")),a.find(\".line[data-option=rows] input\").val(Helpers.arrayGet(e.options,\"rows\",\"\")),a.find(\".field-label\").html(Helpers.arrayGet(e,\"title\",\"Text\")),a.find(\".field-slug\").html(Helpers.arrayGet(e,\"slug\",\"text\")),a.find(\".field-type\").html(Helpers.arrayGet(e,\"type\",\"text\")),a.removeClass(\"active\"),a.attr(\"data-position\",l+1),u(e.items,a.find(\".sortable-wrapper\")),t.append(a)})};u(l,$(\".sortable-wrapper\"))},t.prototype.exportRulesToJson=function(){var e=[];return $(\".custom-fields-rules .line-group-container .line-group\").each(function(){var t=$(this),l=[];t.find(\".rule-line\").each(function(e,t){var a=$(this),i={name:a.find(\".rule-a\").val(),type:a.find(\".rule-type\").val(),value:a.find(\".rule-b:not(.hidden)\").val()};l.push(i)}),l.length>0&&e.push(l)}),e},t.prototype.exportFieldsToJson=function(){var e=[],t=function(e,l){e.each(function(e,a){var i={},n=$(this);i.id=n.data(\"id\")||0,i.title=n.find(\"> .item-details > .line[data-option=title] input[type=text]\").val()||null,i.slug=n.find(\"> .item-details > .line[data-option=slug] input[type=text]\").val()||null,i.instructions=n.find(\"> .item-details > .line[data-option=instructions] textarea\").val()||null,i.type=n.find(\"> .item-details > .line[data-option=type] select\").val()||null,i.options={defaultValue:n.find(\"> .item-details > .options > .line[data-option=defaultvalue] input[type=text]\").val()||null,defaultValueTextarea:n.find(\"> .item-details > .options > .line[data-option=defaultvaluetextarea] textarea\").val()||null,placeholderText:n.find(\"> .item-details > .options > .line[data-option=placeholdertext] input[type=text]\").val()||null,wysiwygToolbar:n.find(\"> .item-details > .options > .line[data-option=wysiwygtoolbar] select\").val()||null,selectChoices:n.find(\"> .item-details > .options > .line[data-option=selectchoices] textarea\").val()||null,buttonLabel:n.find(\"> .item-details > .options > .line[data-option=buttonlabel] input[type=text]\").val()||null,rows:n.find(\"> .item-details > .options > .line[data-option=rows] input[type=number]\").val()||null},i.items=[],t(n.find(\"> .item-details > .options > .line[data-option=repeater] > .col-xs-9 > .add-new-field > .sortable-wrapper > .ui-sortable-handle\"),i.items),l.push(i)})};return t($(\"#custom_field_group_items > .ui-sortable-handle\"),e),e},function(e){e(window).load(function(){new t})}(jQuery)}(this.LaravelElixirBundle=this.LaravelElixirBundle||{});"],"file":"edit-field-group.js"}